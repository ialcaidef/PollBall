# PollBall
20486D_MOD03_LAK

**Configuring Middleware and Services in ASP.NET Core**

http://localhost:puerto/poll-questions.html

Aplicacion donde se muestra una página inicial con la imagen de la pelota empleada en diferentes deportes. Una vez selecciones una y pulsemos en submit te redirige a una página donde te muestra un mensaje donde agradece tu participación y te da la opción de ver los resultados llevandote a otra página.

Se configura el Middleware
public void ConfigureServices(IServiceCollection services)
        {
            services.AddSingleton<IPollResultsService, PollResultsService>();
            services.AddMvc();  //registrábamos los servicios de MVC y Razor Pages
        }

        public void Configure(IApplicationBuilder app, IHostingEnvironment env, IPollResultsService pollResults)
        {
            app.Use(async (context, next) =>
            {
                if (context.Request.Query.ContainsKey("favorite"))
                {
                    string selectedValue = context.Request.Query["favorite"];
                    SelectedGame selectedGame = (SelectedGame)Enum.Parse(typeof(SelectedGame), selectedValue, true);
                    pollResults.AddVote(selectedGame);

                    context.Response.Headers.Add("content-type", "text/html");
                    await context.Response.WriteAsync("Thank you for submitting the poll. You may look at the poll results <a href='/?submitted=true'>Here</a>.");
                }
                else
                {
                    await next.Invoke();
                }
            });

            app.UseStaticFiles();

            app.UseMvcWithDefaultRoute();  //Los controladores de ASP.NET Core usan el middleware de enrutamiento para hacer coincidir las direcciones URL de las solicitudes entrantes y asignarlas a las acciones. Plantillas de rutas:

            app.Run(async (context) =>
            {
                await context.Response.WriteAsync("This text was generated by the app.Run middleware. wwwroot folder path: " + env.WebRootPath);
            });
        }
El método ConfigureServices de la clase Startup nos permitirá configurar o registrar los servicios de aplicación. En el método Configure de la clase Startup crearemos la canalización del procesado de las peticiones de la aplicación. El runtime llamará al iniciar la aplicación a ConfigureServices y Configure.

Con ASP.NET Core, si queremos que desde nuestra aplicación se procesen peticiones a archivos estáticos debemos habilitarlo de forma expresa añadiendo un middleware con esta capacidad al pipeline. No habrá nadie por debajo, como en el caso de IIS, que lo vaya a hacer por nosotros.

En la práctica, esto tendremos que hacerlo en casi todas las aplicaciones, aunque hay algunos escenarios (por ejemplo, sistemas que ejerzan exclusivamente como proveedores de servicios o APIs a otras aplicaciones o sistemas cliente).

ASP.NET Core aporta de serie un middleware que, ubicado en el pipeline, vigilará las peticiones entrantes y tomará el control cuando la ruta del recurso solicitado coincida con un archivo estático existente en el sistema de archivos, retornando su contenido.

Este middleware, implementado en la clase StaticFilesMiddleware, se encuentra disponible en el paquete Nuget Microsoft.AspNetCore.StaticFiles, y debemos introducirlo en el pipeline desde el método Configure() de la clase Startup:

public void Configure(IApplicationBuilder app)
{
    ...
    app.UseStaticFiles();
    ...
}
Tras ello, una petición como "/test.html" retornaría el archivo con el mismo nombre ubicado en el raíz de la carpeta wwwroot del proyecto y lo mismo ocurriría con el resto de peticiones dirigidas a otros tipos de contenidos estáticos, como archivos de scripts u hojas de estilo. En estos casos, el periplo de la petición a través del pipeline finalizaría y se retornaría al cliente el contenido del archivo solicitado.

Sin embargo, si la ruta de una solicitud no coincidiera con la de un archivo estático existente, el middleware simplemente dejaría continuar la petición por el pipeline, de forma que middlewares posicionados posteriormente aún tendrían oportunidad de procesarla, retornándose un error 404 si finalmente no es gestionada por ningún componente.
https://www.variablenotfound.com/2016/03/archivos-estaticos-en-aspnet-core-1.html

StratUp o MiddleWare que invoca al mvc con lo que deja el mando al controlador Controller que con el static-file te abre la página que hay en wwwroot.

Primero el Starup o MiddleWare comprueba si la url contiene favorite. Si es así muestra la página dando las gracias y con el enlace a la lista de favoritos. Si no
da el relevo al mvc que invoca al controlador. Este pregunta si laurl contiene la palabra submit. Si es así muestra la lista de favoritos y si no muestra la página de
inicio con las pelotas

Con inyeccion de dependencia y Service.AddSingleton le inyectamos nuestra clase e Interface que guarda las votaciones de las pelotas favoritas. Al ser Sigleton se almacena
aún si cambiamos de navegador
